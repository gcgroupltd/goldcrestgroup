{%- comment -%}
  UPDATED CODE:
  1. Added a new wrapper div ".newsletter-content-fw__inner" in the HTML to contain all text and form elements.
  2. Updated the CSS to center this new wrapper and apply a max-width, ensuring all content inside is perfectly aligned.
{%- endcomment -%}

{%- style -%}
  #shopify-section-{{ section.id }} .newsletter-section-full-width {
    padding: 0;
    margin: 40px 0;
  }

  #shopify-section-{{ section.id }} .newsletter-container-fw {
    display: grid;
    grid-template-columns: 1fr 1fr;
    align-items: stretch;
    background-color: {{ section.settings.background_color }};
    color: {{ section.settings.text_color }};
    overflow: hidden;
    border-radius: 8px;
    position: relative;
  }

  #shopify-section-{{ section.id }} .newsletter-content-fw {
    padding: 50px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    /* --- MODIFIED: This centers the new inner container --- */
    align-items: center;
  }

  /* --- NEW: This container holds all the content and controls the width --- */
  #shopify-section-{{ section.id }} .newsletter-content-fw__inner {
    max-width: 450px;
    width: 100%;
    text-align: left;
  }

  #shopify-section-{{ section.id }} .newsletter-image-fw {
    position: relative;
    min-height: 450px;
  }

  #shopify-section-{{ section.id }} .newsletter-image-fw img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  #shopify-section-{{ section.id }} .newsletter-heading-fw {
    font-size: 32px;
    margin-top: 0;
    margin-bottom: 15px;
    color: inherit;
  }

  #shopify-section-{{ section.id }} .newsletter-text-fw {
    font-size: 16px;
    line-height: 1.6;
    margin-bottom: 30px;
    /* max-width is now controlled by the inner container */
  }

  #shopify-section-{{ section.id }} .newsletter-form {
    max-width: 100%;
  }

  #shopify-section-{{ section.id }} .newsletter-form__message {
    color: #00af87;
  }
  
  #shopify-section-{{ section.id }} .newsletter-form__field-wrapper .field {
    display: flex;
    align-items: center;
    background-color: #FFFFFF;
    border: 1px solid #ccc;
    border-radius: 4px;
    overflow: hidden;
    /* max-width is now controlled by the inner container */
  }

  #shopify-section-{{ section.id }} .newsletter-form-fw__field-wrapper input {
    background: white;
    color: var(--text-colour);
  }

  #shopify-section-{{ section.id }} .newsletter-form-fw__field-wrapper label {
    color: var(--text-colour);
  }

  #shopify-section-{{ section.id }} .newsletter-form__field-wrapper .field__input {
    flex-grow: 1;
    border: none;
    padding: 12px 15px;
    min-width: 0;
    color: #333;
  }
  
  #shopify-section-{{ section.id }} .newsletter-form__field-wrapper .field__input:focus {
    box-shadow: none;
  }
  
  #shopify-section-{{ section.id }} .newsletter-form__field-wrapper .field__label {
    display: none;
  }

  #shopify-section-{{ section.id }} .newsletter-form-fw__button {
    flex-shrink: 0;
    border-radius: 0;
    margin: 0;
    padding: 12px 20px;
  }

  #shopify-section-{{ section.id }} .newsletter-form-fw__button:hover {
    opacity: 0.85;
  }

  #shopify-section-{{ section.id }} .newsletter-privacy-text-fw {
    font-size: 14px;
    margin-top: 15px;
    opacity: 0.8;
    color: inherit !important;
    /* max-width is now controlled by the inner container */
  }

  #shopify-section-{{ section.id }} .newsletter-privacy-text-fw a {
    color: inherit !important;
    text-decoration: underline !important;
  }

  @media screen and (max-width: 768px) {
    #shopify-section-{{ section.id }} .newsletter-container-fw {
      grid-template-columns: 1fr;
      border-radius: 0;
      min-height: 450px;
    }
    
    #shopify-section-{{ section.id }} .newsletter-content-fw {
      align-items: stretch; /* Let content stretch on mobile */
      text-align: center;
      position: relative;
      z-index: 2;
      color: #FFFFFF;
      padding: 50px 20px;
    }

    #shopify-section-{{ section.id }} .newsletter-container-fw::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1;
    }

    #shopify-section-{{ section.id }} .newsletter-image-fw {
      display: block;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
    }

    #shopify-section-{{ section.id }} .newsletter-form__field-wrapper .field {
      margin: 0 auto;
      max-width: 100%;
    }
    #shopify-section-{{ section.id }} .newsletter-privacy-text-fw {
      margin-left: auto;
      margin-right: auto;
    }

    #shopify-section-{{ section.id }} .newsletter-privacy-text-fw,
    #shopify-section-{{ section.id }} .newsletter-privacy-text-fw a {
      color: #FFFFFF !important;
    }
    
    #shopify-section-{{ section.id }} .newsletter-content-fw__inner {
      text-align: center; /* Center text inside the container on mobile */
    }
  }
{%- endstyle -%}

<div class="newsletter-section-full-width">
  <div class="newsletter-container-fw">
    <div class="newsletter-content-fw">
      {%- comment -%} {%- endcomment -%}
      <div class="newsletter-content-fw__inner">

        {%- if section.settings.heading != blank -%}
          <h2 class="newsletter-heading-fw">{{ section.settings.heading }}</h2>
        {%- endif -%}

        {%- if section.settings.text != blank -%}
          <div class="newsletter-text-fw">{{ section.settings.text }}</div>
        {%- endif -%}
        
        {%- form 'customer', class: 'newsletter-form' -%}
          <input type="hidden" name="contact[tags]" value="newsletter">
          <div class="newsletter-form-fw__field-wrapper">
            <div class="field">
              <input
                id="NewsletterForm--{{ section.id }}"
                type="email"
                name="contact[email]"
                class="field__input"
                value="{{ form.email }}"
                aria-required="true"
                autocorrect="off"
                autocapitalize="off"
                autocomplete="email"
                {% if form.errors %}
                  autofocus
                  aria-invalid="true"
                  aria-describedby="Newsletter-error--{{ section.id }}"
                {% elsif form.posted_successfully? %}
                  aria-describedby="Newsletter-success--{{ section.id }}"
                {% endif %}
                placeholder="Email address"
              >
              <label class="field__label" for="NewsletterForm--{{ section.id }}">
                Email address
              </label>
              <button type="submit" class="button newsletter-form-fw__button button--primary" name="commit" id="Subscribe">
                SUBSCRIBE
              </button>
            </div>
            {%- if form.errors -%}
              <small class="newsletter-form__message form__message" id="Newsletter-error--{{ section.id }}">
                {%- render 'icon-error' -%}
                {{ form.errors.translated_fields['email'] | capitalize }} {{ form.errors.messages['email'] }}
              </small>
            {%- endif -%}
          </div>
          {%- if form.posted_successfully? -%}
            <h3 class="newsletter-form__message newsletter-form__message--success form__message" id="Newsletter-success--{{ section.id }}" tabindex="-1" autofocus>
              {%- render 'icon-success' -%}
              {{ 'newsletter.success' | t }}
            </h3>
          {%- endif -%}
        {%- endform -%}

        <div class="newsletter-privacy-text-fw">
          <p>
              {{ section.settings.privacy_text }}
          </p>
        </div>
      
      </div> {%- comment -%} {%- endcomment -%}
    </div>

    <div class="newsletter-image-fw">
      {%- if section.settings.image != blank -%}
        <img 
          src="{{ section.settings.image | image_url: width: 1200 }}" 
          alt="{{ section.settings.image.alt | default: section.settings.heading | escape }}"
          width="1200"
          height="{{ 1200 | divided_by: section.settings.image.aspect_ratio | round }}"
          loading="lazy"
        >
      {%- endif -%}
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Custom Newsletter",
  "tag": "section",
  "class": "section section--full-width",
  "settings": [
    {
      "type": "image_picker",
      "id": "image",
      "label": "Image"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Content Background Color",
      "info": "Used as the desktop background for the content and as a fallback on mobile if no image is selected.",
      "default": "#F3F3F3"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color (Desktop)",
      "default": "#333333"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Sign up to our newsletter"
    },
    {
      "type": "richtext",
      "id": "text",
      "label": "Text",
      "default": "<p>Enter your email address to receive updates on our latest collections, trends and exclusive offers.</p>"
    },
    {
      "type": "richtext",
      "id": "privacy_text",
      "label": "Privacy Policy Text",
      "default": "<p>We take safeguarding your details seriously. See our <a href='/privacy-policy'>privacy policy</a>."
    }
  ],
  "presets": [
    {
      "name": "Custom Newsletter"
    }
  ]
}
{% endschema %}